#ifndef __CONSOLE_MENU_H__
#define __CONSOLE_MENU_H__

#include <types.h>
#include <mem.h>
#include <picture.h>

#include "menuimpl.h"
#include "frame.h"
#include "control.h"

//////////////////////////////////////////////////////////////////////////
///Контрол консоли
//////////////////////////////////////////////////////////////////////////
class ConsoleCtrl: public Control
{
  public:
    ConsoleCtrl (Console*);

    void up   ();
    void down ();

  private:
    Console* owner;        
};

//////////////////////////////////////////////////////////////////////////
///Текстовая консоль
//////////////////////////////////////////////////////////////////////////
class Console: public Frame
{
  public:
    Console (Menu* owner,const char* name);

//////////////////////////////////////////////////////////////////////////
///Очистка текстовой консоли
//////////////////////////////////////////////////////////////////////////
    void clear ();

//////////////////////////////////////////////////////////////////////////
///Изменение размера консоли
//////////////////////////////////////////////////////////////////////////
    void resize (int,int);

//////////////////////////////////////////////////////////////////////////
///Вывод текста в текстовую консоль
//////////////////////////////////////////////////////////////////////////
    void printf  (color_t color,const char* message,...);
    void printf  (const char* message,...);
    void vprintf (color_t color,const char* message,va_list);
    void vprintf (const char* message,va_list);

//////////////////////////////////////////////////////////////////////////
///Позиционирование
//////////////////////////////////////////////////////////////////////////
    void seek (int top_line);
    int tell () const { return top_line; }

//////////////////////////////////////////////////////////////////////////
///Перерисовка
//////////////////////////////////////////////////////////////////////////
    void draw ();

//////////////////////////////////////////////////////////////////////////
///Команда подтверждения
//////////////////////////////////////////////////////////////////////////
    void SetCommand (CmdType type,const char* cmd) { ctrl.SetCommand (type,cmd); }

  private:
    void putline ();
    void _draw ();

  private:
    struct Line {
      color_t	color;
      char* 	msg;
    };

    ConsoleCtrl ctrl;
    char  buf [CONSOLE_BUF_SIZE];
    Line  line [CONSOLE_LINES_NUM];
    char  *pos, *end;
    char  *line_start_pos;    
    Line  *cur_line, *end_line;
    color_t	color;
    int	  top_line;
    int   con_height;
};

#endif
